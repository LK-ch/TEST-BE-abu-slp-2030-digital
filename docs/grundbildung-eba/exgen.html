<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLP EBA Umsetzungsvarianten-Generator (v2)</title>
    <style>
        :root {
            --zh-blue: #0F05A0; --zh-blue-light: #3A30C2; --zh-blue-lighter: #E8E6FF;
            --zh-white: #FFFFFF; --zh-gray-light: #F5F5F5; --zh-gray: #E0E0E0;
            --zh-gray-dark: #666666; --zh-success: #28A745; --zh-warning: #FFC107;
            --zh-danger: #DC3545; --border-radius: 8px; --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, var(--zh-blue-lighter) 0%, var(--zh-white) 100%); min-height: 100vh; color: #333; }
        .header { background: var(--zh-blue); color: var(--zh-white); padding: 1.5rem; box-shadow: var(--shadow); }
        .header h1 { font-size: 1.8rem; font-weight: 600; margin-bottom: 0.5rem; }
        .year-selector-group button { width: 100%; margin-top: 0.5rem; padding: 0.75rem 1rem; border: 2px solid var(--zh-blue); background: var(--zh-white); color: var(--zh-blue); border-radius: var(--border-radius); cursor: pointer; transition: all 0.3s ease; }
        .year-selector-group button.active { background: var(--zh-blue); color: var(--zh-white); }
        .progress-container { background: var(--zh-white); padding: 1rem 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .progress-bar { height: 8px; background: var(--zh-gray); border-radius: 4px; overflow: hidden; margin-top: 0.5rem; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--zh-blue) 0%, var(--zh-blue-light) 100%); width: 0%; transition: width 0.3s ease; }
        .container { display: flex; flex-wrap: wrap; gap: 1.5rem; padding: 1.5rem; max-width: 1600px; margin: 0 auto; }
        .wizard-column, .preview-column { flex: 1; min-width: 350px; background: var(--zh-white); border-radius: var(--border-radius); box-shadow: var(--shadow); display: flex; flex-direction: column; max-height: calc(100vh - 200px); }
        .wizard-column-content { overflow-y: auto; padding: 1.5rem; }
        .step-section { margin-bottom: 2rem; padding: 1.5rem; background: var(--zh-gray-light); border-radius: var(--border-radius); border: 2px solid transparent; transition: all 0.3s ease; }
        .step-section.active { border-color: var(--zh-blue); background: var(--zh-white); box-shadow: 0 0 0 3px rgba(15,5,160,0.1); }
        .step-section.completed { opacity: 0.8; background: var(--zh-blue-lighter); }
        .step-header { display: flex; align-items: center; margin-bottom: 1rem; }
        .step-number { background: var(--zh-blue); color: var(--zh-white); min-width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 1rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--zh-gray-dark); }
        select, textarea { width: 100%; padding: 0.75rem; border: 2px solid var(--zh-gray); border-radius: var(--border-radius); font-size: 1rem; background: var(--zh-white); }
        select:focus, textarea:focus { outline: none; border-color: var(--zh-blue); box-shadow: 0 0 0 3px rgba(15,5,160,0.1); }
        button { padding: 0.75rem 1.5rem; border-radius: var(--border-radius); border: none; font-size: 0.95rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--zh-blue); color: var(--zh-white); }
        .preview-header { padding: 1.5rem; border-bottom: 2px solid var(--zh-gray-light); }
        .preview-content { flex: 1; padding: 1.5rem; overflow-y: auto; }
        .preview-footer { padding: 1rem 1.5rem; border-top: 2px solid var(--zh-gray-light); }
        .checkbox-group { max-height: 150px; overflow-y: auto; background: var(--zh-white); border: 2px solid var(--zh-gray); border-radius: var(--border-radius); padding: 0.75rem; }
        .checkbox-group label { display: flex; align-items: center; margin-bottom: 0.75rem; cursor: pointer; font-weight: normal; }
        .checkbox-group input[type="checkbox"] { width: auto; margin-right: 0.75rem; }
    </style>
</head>
<body>
    <header class="header"><h1>SLP EBA Umsetzungsvarianten-Generator</h1></header>
    <div class="progress-container"><div id="progressText"></div><div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div></div>
    <div class="container">
        <div class="wizard-column">
            <div class="wizard-column-content">
                <div class="step-section" data-step="1">
                    <div class="step-header"><div class="step-number">1</div><h3>Lehrjahr ausw√§hlen</h3></div>
                    <div class="year-selector-group">
                        <button id="year1Btn" onclick="handleYearSelect(1)">1. Lehrjahr (Themen 1-4)</button>
                        <button id="year2Btn" onclick="handleYearSelect(2)">2. Lehrjahr (Themen 5-8)</button>
                    </div>
                </div>
                <div class="step-section" data-step="2">
                    <div class="step-header"><div class="step-number">2</div><h3>Thema ausw√§hlen</h3></div>
                    <select id="thema" onchange="handleSelectChange(event, 2)"></select>
                </div>
                <div class="step-section" data-step="3">
                    <div class="step-header"><div class="step-number">3</div><h3>Individueller Lebensbezug</h3></div>
                    <select id="lebensbezug" onchange="handleSelectChange(event, 3)"></select>
                </div>
                <div class="step-section" data-step="4">
                    <div class="step-header"><div class="step-number">4</div><h3>Lerninhalt</h3></div>
                    <select id="lerninhalt" onchange="handleSelectChange(event, 4)"></select>
                </div>
                <div class="step-section" data-step="5">
                    <div class="step-header"><div class="step-number">5</div><h3>Kompetenzen ausw√§hlen</h3></div>
                    <div id="kompetenzen-wrapper"></div>
                    <button class="btn-primary" style="margin-top: 1rem;" onclick="handleCompetencyConfirm()">Kompetenzen best√§tigen</button>
                </div>
                </div>
        </div>
        <div class="preview-column">
            <div class="preview-header"><h2>Vorschau</h2></div>
            <div class="preview-content" id="previewContent"></div>
            <div class="preview-footer"><button class="btn-primary" onclick="window.print()">üñ®Ô∏è Drucken</button></div>
        </div>
    </div>

    <script>
        // === 1. KONFIGURATION & DATEN (PLATZHALTER) ===
        const CLOUDFLARE_WORKER_URL = "https://abu-aufgaben-api.cglaus.workers.dev";
        let SLP_DATA = {};
        let SCHLUESSELKOMPETENZEN = {};
        let SPRACHMODI = {};
        let GESELLSCHAFTLICHE = {};

        // === 2. STATE MANAGEMENT ===
        let state = {};

        function getInitialState() {
            return {
                lehrjahr: null,
                currentStep: 1,
                selections: {
                    thema: null,
                    lebensbezug: null,
                    lerninhalt: null,
                    kompetenzen: null
                },
            };
        }

        // === 3. RENDER-FUNKTIONEN (Die einzige Quelle der Wahrheit f√ºr die UI) ===

        function renderUI() {
            // -- Fortschrittsbalken --
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const totalSteps = 5; // Nur die Auswahl-Schritte
            const completedSteps = state.currentStep - 1;
            progressFill.style.width = `${(completedSteps / totalSteps) * 100}%`;
            progressText.textContent = state.lehrjahr ? `${state.lehrjahr}. Lehrjahr ‚Ä¢ Schritt ${state.currentStep}` : 'Bitte Lehrjahr w√§hlen';
            
            // -- Wizard-Schritte --
            document.querySelectorAll('.step-section').forEach(section => {
                const step = parseInt(section.dataset.step);
                const inputs = section.querySelectorAll('button, select, input');
                
                section.classList.remove('active', 'completed');
                
                if (step < state.currentStep) {
                    section.classList.add('completed');
                    inputs.forEach(el => el.disabled = false);
                } else if (step === state.currentStep) {
                    section.classList.add('active');
                    inputs.forEach(el => el.disabled = false);
                } else {
                    inputs.forEach(el => el.disabled = true);
                }
            });

            // Button-Aktivit√§t
            if(state.lehrjahr) {
                document.getElementById('year1Btn').classList.toggle('active', state.lehrjahr === 1);
                document.getElementById('year2Btn').classList.toggle('active', state.lehrjahr === 2);
            }

            // -- Vorschau --
            renderPreview();
        }

        function renderPreview() {
            const preview = document.getElementById('previewContent');
            if (!state.lehrjahr) {
                preview.innerHTML = `<p>Bitte ein Lehrjahr w√§hlen, um zu starten.</p>`;
                return;
            }
            let html = `<h3>${state.lehrjahr}. Lehrjahr</h3>`;
            const { thema, lebensbezug, lerninhalt, kompetenzen } = state.selections;

            if (thema) {
                 const themaData = SLP_DATA[`lehrjahr${state.lehrjahr}`].themen.find(t => t.nummer == thema);
                 html += `<p><strong>Thema:</strong> ${themaData.titel}</p>`;
            }
            // ... Weitere Preview-Logik hier ...
            preview.innerHTML = html;
        }


        // === 4. EVENT HANDLERS (√Ñndern nur den State und rufen renderUI auf) ===

        function handleYearSelect(year) {
            state = getInitialState();
            state.lehrjahr = year;
            state.currentStep = 2;
            populateThemen();
            renderUI();
        }
        
        function handleSelectChange(event, step) {
            const value = event.target.value;
            if (!value) return;

            if (step === 2) {
                state.selections.thema = value;
                state.currentStep = 3;
                populateLebensbezuege();
            } else if (step === 3) {
                state.selections.lebensbezug = value;
                state.currentStep = 4;
                populateLerninhalte();
            } else if (step === 4) {
                state.selections.lerninhalt = value;
                state.currentStep = 5;
                populateKompetenzen();
            }
            renderUI();
        }
        
        function handleCompetencyConfirm() {
            const getChecked = id => Array.from(document.querySelectorAll(`#${id} input:checked`)).map(cb => cb.value);
            const sk = getChecked('schluesselkompetenzen-container');
            const sm = getChecked('sprachmodi-container');

            if (sk.length < 2 || sm.length < 1) {
                alert('Bitte mindestens 2 Schl√ºsselkompetenzen und 1 Sprachmodus ausw√§hlen.');
                return;
            }
            
            state.selections.kompetenzen = { sk, sm };
            state.currentStep = 6; // N√§chster Schritt (z.B. Herausforderung)
            alert("Kompetenzen best√§tigt! N√§chste Schritte k√∂nnen nun implementiert werden.");
            renderUI();
        }


        // === 5. DATENLADE-FUNKTIONEN (F√ºllen die UI-Elemente) ===

        function populateThemen() {
            const select = document.getElementById('thema');
            const data = SLP_DATA[`lehrjahr${state.lehrjahr}`];
            select.innerHTML = '<option value="">-- Bitte w√§hlen --</option>';
            data.themen.forEach(t => select.add(new Option(`Thema ${t.nummer}: ${t.titel}`, t.nummer)));
        }

        function populateLebensbezuege() {
            const select = document.getElementById('lebensbezug');
            const thema = SLP_DATA[`lehrjahr${state.lehrjahr}`].themen.find(t => t.nummer == state.selections.thema);
            select.innerHTML = '<option value="">-- Bitte w√§hlen --</option>';
            thema.lebensbezuege.forEach((lb, index) => select.add(new Option(lb.titel, index)));
        }
        
        function populateLerninhalte() {
            const select = document.getElementById('lerninhalt');
            const lebensbezug = SLP_DATA[`lehrjahr${state.lehrjahr}`].themen.find(t => t.nummer == state.selections.thema).lebensbezuege[state.selections.lebensbezug];
            select.innerHTML = '<option value="">-- Bitte w√§hlen --</option>';
            lebensbezug.lerninhalte.forEach((li, index) => select.add(new Option(li.titel, index)));
        }

        function populateKompetenzen() {
            const wrapper = document.getElementById('kompetenzen-wrapper');
            const lerninhalt = SLP_DATA[`lehrjahr${state.lehrjahr}`].themen
                .find(t => t.nummer == state.selections.thema)
                .lebensbezuege[state.selections.lebensbezug]
                .lerninhalte[state.selections.lerninhalt];

            const createCheckboxes = (title, containerId, items, defs) => {
                let html = `<div class="competence-category"><h5>${title}</h5><div id="${containerId}" class="checkbox-group">`;
                items.forEach(key => {
                    html += `<label><input type="checkbox" value="${key}" checked> ${key} - ${defs[key] || key}</label>`;
                });
                html += `</div></div>`;
                return html;
            };

            wrapper.innerHTML = 
                createCheckboxes('Schl√ºsselkompetenzen', 'schluesselkompetenzen-container', lerninhalt.schluesselkompetenzen, SCHLUESSELKOMPETENZEN) +
                createCheckboxes('Sprachmodi', 'sprachmodi-container', lerninhalt.sprachmodi, SPRACHMODI);
        }

        // === 6. INITIALISIERUNG & DATEN-PLATZHALTER ===
        function loadStaticData() {
            SCHLUESSELKOMPETENZEN = {"3.2.1": "Zwischen relevanten und irrelevanten Quellen und Inhalten unterscheiden", "3.2.2": "Sich selbst Ziele setzen...", "3.2.3": "Antizipative, unternehmerische und innovative Wege der Probleml√∂sung...", "3.2.4": "In unterschiedlichen Teams zielgerichtet und effizient arbeiten", "3.2.5": "Die eigenen Werthaltungen und √úberzeugungen erkennen...", "3.2.6": "Ihre eigenen Standpunkte begr√ºnden...", "3.2.7": "Unterschiedliche Standpunkte nachvollziehen...", "3.2.8": "Ihre Lebensphasen planen...", "3.2.9": "Vernetzt und systemisch denken...", "3.2.10": "Sich in einem sich st√§ndig ver√§ndernden Umfeld zurechtfinden", "3.2.11": "Mit Mehrdeutigkeiten umgehen", "3.2.12": "An gesellschaftlichen Prozessen partizipieren..."};
            SPRACHMODI = {"4.2.1.1": "Rezeption m√ºndlich", "4.2.1.2": "Rezeption audiovisuell", "4.2.1.3": "Rezeption schriftlich und bildlich", "4.2.2.1": "Produktion m√ºndlich", "4.2.2.2": "Produktion schriftlich und bildlich", "4.2.2.3": "Produktion multimedial", "4.2.3.1": "Interaktion und Kollaboration m√ºndlich", "4.2.3.2": "Interaktion und Kollaboration schriftlich", "4.2.3.3": "Interaktion und Kollaboration digital"};
            GESELLSCHAFTLICHE = { /* ... */ };
            SLP_DATA = { /* ... Das komplette, riesige SLP_DATA Objekt von vorhin ... */ };
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
